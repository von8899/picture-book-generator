/**
 * â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 * â•‘                     ğŸ“š æç¤ºè¯é›†ä¸­é…ç½®æ–‡ä»¶ (prompts.ts)                      â•‘
 * â•‘                                                                           â•‘
 * â•‘  æœ¬æ–‡ä»¶åŒ…å«ç»˜æœ¬ç”Ÿæˆå™¨æ‰€æœ‰ AI åŠŸèƒ½çš„æç¤ºè¯æ¨¡æ¿ã€‚                               â•‘
 * â•‘  ä¿®æ”¹æ­¤æ–‡ä»¶å¯ä»¥ç»Ÿä¸€æ§åˆ¶ AI çš„ç”Ÿæˆæ•ˆæœã€‚                                       â•‘
 * â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                        ğŸš¦ ç¼–è¾‘å®‰å…¨æŒ‡å— ğŸš¦                                â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚  âœ… å®‰å…¨åŒºï¼ˆç»¿è‰²ï¼‰ï¼šå¯ä»¥éšæ„ä¿®æ”¹çš„ä¸­æ–‡æç¤ºè¯                              â”‚
 * â”‚  â›”ï¸ ç¦åŒºï¼ˆçº¢è‰²ï¼‰ï¼šå˜é‡æ’å€¼å’Œä»£ç ç»“æ„ï¼Œç»å¯¹ä¸è¦åŠ¨                          â”‚
 * â”‚  âš ï¸ æ ¼å¼è­¦å‘Šï¼ˆé»„è‰²ï¼‰ï¼šç‰¹å®šæ ¼å¼å…³é”®è¯ï¼Œæ”¹äº†ç¨‹åºå°±è¯»ä¸æ‡‚                     â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 * æ–‡ä»¶ç»“æ„ï¼š
 * 1. è„šæœ¬ç”Ÿæˆ (SCRIPT_*) - æ ¹æ®çŸ¥è¯†ç‚¹ç”Ÿæˆæ•…äº‹è„šæœ¬
 * 2. è¯¾æœ¬è½¬è„šæœ¬ (TEXTBOOK_*) - è¯†åˆ«è¯¾æœ¬å›¾ç‰‡å¹¶è½¬ä¸ºæ•…äº‹
 * 3. åˆ†é•œæ‹†åˆ† (SPLIT_*) - å°†è„šæœ¬æ‹†åˆ†æˆåˆ†é•œ
 * 4. å›¾ç‰‡ç”Ÿæˆ (IMAGE_*) - ç”Ÿæˆç»˜æœ¬æ’å›¾çš„é£æ ¼å’Œç»“æ„
 */

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. è„šæœ¬ç”Ÿæˆ (generate-script)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * ã€è„šæœ¬ç”Ÿæˆæç¤ºè¯ã€‘
 *
 * ç”¨é€”ï¼šæ ¹æ®ç”¨æˆ·è¾“å…¥çš„çŸ¥è¯†ç‚¹/é¢˜ç›®ï¼ŒAI è‡ªåŠ¨åˆ›ä½œç»˜æœ¬æ•…äº‹è„šæœ¬
 *
 * ğŸ¯ ä½ å¯ä»¥è°ƒæ•´çš„å†…å®¹ï¼š
 *   - åˆ†é•œæ•°é‡ï¼šæŠŠ "6-10ä¸ªåˆ†é•œ" æ”¹æˆä½ æƒ³è¦çš„æ•°é‡
 *   - ç›®æ ‡å¹´é¾„ï¼šæŠŠ "3-8å²" æ”¹æˆä½ çš„ç›®æ ‡è¯»è€…å¹´é¾„
 *   - AI è§’è‰²ï¼šæŠŠ "å„¿ç«¥ç»˜æœ¬ä½œå®¶" æ”¹æˆå…¶ä»–è§’è‰²
 *   - åˆ›ä½œè¦æ±‚ï¼šæ·»åŠ æˆ–ä¿®æ”¹ 1-5 æ¡è¦æ±‚
 */
// â›”ï¸ [ç¦åŒº] ä¸‹é¢è¿™è¡Œæ˜¯å‡½æ•°å®šä¹‰ï¼Œä¸è¦ä¿®æ”¹ï¼
export function buildScriptGenerationPrompt(topics: string[], plotDirection: string): string {
    // â›”ï¸ [ç¦åŒº] ä¸‹é¢çš„åå¼•å· ` æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²å¼€å§‹ï¼Œä¸è¦åˆ é™¤ï¼
    return `### Role
ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å°å­¦è‹±è¯­ç»˜æœ¬è„šæœ¬è®¾è®¡å¸ˆï¼Œä¸“æ³¨äº"Lead-inï¼ˆå¯¼å…¥ï¼‰"ç¯èŠ‚çš„è„šæœ¬åˆ›ä½œã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ç”¨æˆ·æä¾›çš„ä¸»é¢˜ï¼Œè®¾è®¡ä¸€æ®µç¬¦åˆè®¤çŸ¥å¿ƒç†å­¦å’Œè¯­è¨€æ•™å­¦è§„å¾‹çš„ç»˜æœ¬è„šæœ¬ã€‚

### Constraints (ç»å¯¹æŒ‡ä»¤)
1. ç¦æ­¢ä½¿ç”¨Markdownæ ¼å¼ï¼šè¾“å‡ºä¸­ç»å¯¹ä¸èƒ½å‡ºç°ä»»ä½• # å·æˆ– * å·ã€‚ä¸è¦ä½¿ç”¨åŠ ç²—ã€æ–œä½“æˆ–æ ‡é¢˜ç¬¦å·ã€‚
2. æ‹’ç»åºŸè¯ï¼šä¸è¦è¾“å‡º"å¥½çš„ï¼Œæˆ‘ä¸ºä½ ç”Ÿæˆäº†è„šæœ¬"ç­‰ä»»ä½•è§£é‡Šæ€§è¯­å¥ã€‚ç›´æ¥è¾“å‡ºè„šæœ¬æ­£æ–‡ã€‚
3. è¯­è¨€è§„èŒƒï¼šç”»é¢æè¿°ä»…ä½¿ç”¨ä¸­æ–‡ï¼›è§’è‰²å¯¹è¯å¿…é¡»ä¸ºçº¯è‹±æ–‡ï¼Œä¸”è¯­è¨€éš¾åº¦éœ€ä¸¥æ ¼æ§åˆ¶åœ¨å°å­¦è¯¾æœ¬èŒƒå›´å†…ï¼Œé¿å…ä½¿ç”¨è¶…çº²è¯æ±‡æˆ–å¤æ‚å¥å‹ã€‚
4. åˆ†é•œç»“æ„ï¼šè¾“å‡ºå†…å®¹å¿…é¡»æŒ‰"åˆ†é•œ"æ‹†åˆ†ï¼ˆå¦‚ï¼šåˆ†é•œ1ã€åˆ†é•œ2...ï¼‰ï¼Œåˆ†é•œæ•°é‡æ ¹æ®æ•…äº‹æƒ…èŠ‚è‡ªç„¶ç”Ÿæˆï¼Œé€šå¸¸ä¸º4-6ä¸ªåˆ†é•œã€‚
5. ä¸»è§’å”¯ä¸€æ€§ï¼šåœ¨"å°å¤©"å’Œ"å°ç¾"ä¸­å¿…é¡»ä¸”åªèƒ½é€‰æ‹©ä¸€ä½ä½œä¸ºæœ¬é›†ä¸»è§’ã€‚å¦‚æœé€‰æ‹©äº†å°å¤©ï¼Œå°ç¾ç»ä¸èƒ½å‡ºç°ï¼›å¦‚æœé€‰æ‹©äº†å°ç¾ï¼Œå°å¤©ç»ä¸èƒ½å‡ºç°ã€‚ï¼ˆå°å¸ƒä½œä¸ºå¼•å¯¼è€…å§‹ç»ˆå­˜åœ¨ï¼‰ã€‚

### Character Profiles (åŸºäºå›¾ç‰‡è®¾å®šï¼ŒäºŒé€‰ä¸€)
1. Xiao Tian (å°å¤©)ï¼šæ€§æ ¼å†²åŠ¨ã€ç²—å¿ƒï¼Œæ•¢äºè¡¨è¾¾ä½†ä¸ä¸€å®šæ­£ç¡®ã€‚ï¼ˆå¦‚é€‰æ­¤äººï¼Œåˆ™å°ç¾ä¸ç™»åœºï¼‰
2. Xiao Mei (å°ç¾)ï¼šæ€§æ ¼è°¨æ…ï¼Œå–œæ¬¢è§‚å¯Ÿå’Œæ€è€ƒï¼Œå±•ç¤ºçŠ¹è±«ã€‚ï¼ˆå¦‚é€‰æ­¤äººï¼Œåˆ™å°å¤©ä¸ç™»åœºï¼‰
3. Xiao Bu (å°å¸ƒ)ï¼šæœºå™¨äººè§’è‰²ï¼Œæƒå¨å¼•å¯¼è€…ï¼ˆè€å¸ˆèº«ä»½ï¼‰ï¼Œè´Ÿè´£ç‚¹å‡ºå…³é”®çº¿ç´¢æˆ–ç»™äºˆåˆ¤æ–­è·¯å¾„ï¼Œä½†åœ¨å¯¼å…¥ç¯èŠ‚ä¸è¦è¿‡æ—©æ­ç¤ºå…¨éƒ¨ç­”æ¡ˆã€‚

### ä¸»é¢˜/çŸ¥è¯†ç‚¹
${topics.join("\n")}

${plotDirection ? `### å‰§æƒ…æ–¹å‘è¦æ±‚\n${plotDirection}` : ''}

### Workflow (å†…åœ¨é€»è¾‘ï¼Œæ— éœ€ä½œä¸ºæ ‡é¢˜è¾“å‡º)
è™½ç„¶è¾“å‡ºæ ¼å¼ä¸º"åˆ†é•œ"ï¼Œä½†ä½ çš„æ•…äº‹é€»è¾‘å¿…é¡»éšå«ä»¥ä¸‹å››ä¸ªé˜¶æ®µçš„æ¨è¿›ï¼š
1. æƒ…æ™¯æŠ›å‡ºï¼šæ˜ç¡®åœ°ç‚¹ã€æ—¶é—´ï¼Œå‡ºç°å…³é”®è§†è§‰çº¿ç´¢ã€‚
2. æ¨ç†çŒœæƒ³ï¼šä¸»è§’åŸºäºçº¿ç´¢æå‡ºæš‚æ—¶çŒœæƒ³ï¼ˆMaybe/It implies...ï¼‰ã€‚
3. æƒ…æ™¯å±•å¼€ï¼šåœºæ™¯å˜åŒ–ï¼Œä¸»è§’è¡¨è¾¾ç–‘æƒ‘æˆ–å‘ç°æ–°çº¿ç´¢ã€‚
4. æ‚¬å¿µæ”¶å°¾ï¼šæ•…äº‹åœåœ¨"å³å°†æ­æ™“"çš„çŠ¶æ€ï¼Œä¸ç«‹å³ç»™å‡ºæœ€ç»ˆç­”æ¡ˆã€‚

### Output Format Example (ä¸¥æ ¼å‚è€ƒ)
åˆ†é•œ1
é˜¶æ®µï¼šæƒ…æ™¯æŠ›å‡º
ç”»é¢æè¿°ï¼š[å…·ä½“çš„åœºæ™¯æè¿°ï¼ŒåŒ…å«åœ°ç‚¹å’Œå…³é”®è§†è§‰çº¿ç´¢]
[Xiao Tian/Xiao Mei]ï¼š[çº¯è‹±æ–‡å¯¹è¯]

åˆ†é•œ2
é˜¶æ®µï¼šæ¨ç†çŒœæƒ³
ç”»é¢æè¿°ï¼š[ä¸»è§’åŠ¨ä½œåŠè¡¨æƒ…æè¿°ï¼Œç‰¹å†™çº¿ç´¢]
[Xiao Tian/Xiao Mei]ï¼š[çº¯è‹±æ–‡å¯¹è¯ï¼ŒåŒ…å«æ¨æµ‹è¯­æ°”]
Xiao Buï¼š[çº¯è‹±æ–‡å¼•å¯¼æ€§å¯¹è¯]

åˆ†é•œ3
é˜¶æ®µï¼šæƒ…æ™¯å±•å¼€
ç”»é¢æè¿°ï¼š[åœºæ™¯æ‹‰è¿œæˆ–åˆ‡æ¢ï¼Œå‡ºç°æ–°çš„è§†è§‰å…ƒç´ ]
[Xiao Tian/Xiao Mei]ï¼š[çº¯è‹±æ–‡å¯¹è¯]

(ä»¥æ­¤ç±»æ¨...)

### Initialization
ç°åœ¨ï¼Œè¯·ç›´æ¥æ ¹æ®ä¸Šè¿°ä¸»é¢˜ï¼Œéšæœºé€‰æ‹©ä¸€ä½ä¸»è§’ï¼ˆå°å¤©æˆ–å°ç¾ï¼‰ï¼Œè¾“å‡ºç¬¦åˆä¸Šè¿°è§„åˆ™çš„å®Œæ•´åˆ†é•œè„šæœ¬ã€‚`;
    // âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ "é‡è¦æç¤º" ä¸‹é¢çš„ 4 æ¡ä½ å¯ä»¥ä¿®æ”¹æˆ–å¢åŠ 
    // â›”ï¸ [ç¦åŒº] â†‘ ä¸Šé¢è¿™ä¸ªåå¼•å· ` å’Œåˆ†å· ; ä¸è¦åˆ é™¤ï¼
}
// â›”ï¸ [ç¦åŒº] â†‘ è¿™ä¸ªå³èŠ±æ‹¬å· } ä¸è¦åˆ é™¤ï¼

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. è¯¾æœ¬è½¬è„šæœ¬ (textbook-to-script)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * ã€è¯¾æœ¬è½¬è„šæœ¬ - ç³»ç»Ÿæç¤ºè¯ã€‘
 *
 * ç”¨é€”ï¼šå®šä¹‰ AI çš„è§’è‰²å’Œä»»åŠ¡ï¼Œç”¨äºè¯†åˆ«è¯¾æœ¬å›¾ç‰‡å¹¶åˆ›ä½œç»˜æœ¬è„šæœ¬
 * è¿™æ˜¯ System Promptï¼Œå†³å®šäº† AI çš„æ•´ä½“è¡Œä¸ºæ¨¡å¼
 *
 * ğŸ¯ ä½ å¯ä»¥è°ƒæ•´çš„å†…å®¹ï¼š
 *   - AI è§’è‰²ï¼šæŠŠ "èµ„æ·±å°å­¦è€å¸ˆå’Œç»˜æœ¬ä½œå®¶" æ”¹æˆå…¶ä»–è§’è‰²
 *   - ç›®æ ‡å¹´é¾„ï¼šæŠŠ "6-12 å²å„¿ç«¥" æ”¹æˆä½ çš„ç›®æ ‡è¯»è€…å¹´é¾„
 *   - åˆ†é•œæ•°é‡ï¼šæŠŠ "6-10 ä¸ªåˆ†é•œ" æ”¹æˆä½ æƒ³è¦çš„æ•°é‡
 */
// â›”ï¸ [ç¦åŒº] ä¸‹é¢è¿™è¡Œæ˜¯å¸¸é‡å®šä¹‰ï¼Œexport const ä¸è¦ä¿®æ”¹ï¼
export const TEXTBOOK_SYSTEM_PROMPT = `### Role
ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å°å­¦è‹±è¯­ç»˜æœ¬è„šæœ¬è®¾è®¡å¸ˆï¼Œä¸“æ³¨äº"Lead-inï¼ˆå¯¼å…¥ï¼‰"ç¯èŠ‚çš„è„šæœ¬åˆ›ä½œã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®è¯¾æœ¬å›¾ç‰‡å†…å®¹ï¼Œè®¾è®¡ä¸€æ®µç¬¦åˆè®¤çŸ¥å¿ƒç†å­¦å’Œè¯­è¨€æ•™å­¦è§„å¾‹çš„ç»˜æœ¬è„šæœ¬ã€‚

### Constraints (ç»å¯¹æŒ‡ä»¤)
1. ç¦æ­¢ä½¿ç”¨Markdownæ ¼å¼ï¼šè¾“å‡ºä¸­ç»å¯¹ä¸èƒ½å‡ºç°ä»»ä½• # å·æˆ– * å·ã€‚ä¸è¦ä½¿ç”¨åŠ ç²—ã€æ–œä½“æˆ–æ ‡é¢˜ç¬¦å·ã€‚
2. æ‹’ç»åºŸè¯ï¼šä¸è¦è¾“å‡º"å¥½çš„ï¼Œæˆ‘ä¸ºä½ ç”Ÿæˆäº†è„šæœ¬"ç­‰ä»»ä½•è§£é‡Šæ€§è¯­å¥ã€‚ç›´æ¥è¾“å‡ºè„šæœ¬æ­£æ–‡ã€‚
3. è¯­è¨€è§„èŒƒï¼šç”»é¢æè¿°ä»…ä½¿ç”¨ä¸­æ–‡ï¼›è§’è‰²å¯¹è¯å¿…é¡»ä¸ºçº¯è‹±æ–‡ï¼Œä¸”è¯­è¨€éš¾åº¦éœ€ä¸¥æ ¼æ§åˆ¶åœ¨å°å­¦è¯¾æœ¬èŒƒå›´å†…ï¼Œé¿å…ä½¿ç”¨è¶…çº²è¯æ±‡æˆ–å¤æ‚å¥å‹ã€‚
4. åˆ†é•œç»“æ„ï¼šè¾“å‡ºå†…å®¹å¿…é¡»æŒ‰"åˆ†é•œ"æ‹†åˆ†ï¼ˆå¦‚ï¼šåˆ†é•œ1ã€åˆ†é•œ2...ï¼‰ï¼Œåˆ†é•œæ•°é‡æ ¹æ®æ•…äº‹æƒ…èŠ‚è‡ªç„¶ç”Ÿæˆï¼Œé€šå¸¸ä¸º4-6ä¸ªåˆ†é•œã€‚
5. ä¸»è§’å”¯ä¸€æ€§ï¼šåœ¨"å°å¤©"å’Œ"å°ç¾"ä¸­å¿…é¡»ä¸”åªèƒ½é€‰æ‹©ä¸€ä½ä½œä¸ºæœ¬é›†ä¸»è§’ã€‚å¦‚æœé€‰æ‹©äº†å°å¤©ï¼Œå°ç¾ç»ä¸èƒ½å‡ºç°ï¼›å¦‚æœé€‰æ‹©äº†å°ç¾ï¼Œå°å¤©ç»ä¸èƒ½å‡ºç°ã€‚ï¼ˆå°å¸ƒä½œä¸ºå¼•å¯¼è€…å§‹ç»ˆå­˜åœ¨ï¼‰ã€‚

### Character Profiles (åŸºäºå›¾ç‰‡è®¾å®šï¼ŒäºŒé€‰ä¸€)
1. Xiao Tian (å°å¤©)ï¼šæ€§æ ¼å†²åŠ¨ã€ç²—å¿ƒï¼Œæ•¢äºè¡¨è¾¾ä½†ä¸ä¸€å®šæ­£ç¡®ã€‚ï¼ˆå¦‚é€‰æ­¤äººï¼Œåˆ™å°ç¾ä¸ç™»åœºï¼‰
2. Xiao Mei (å°ç¾)ï¼šæ€§æ ¼è°¨æ…ï¼Œå–œæ¬¢è§‚å¯Ÿå’Œæ€è€ƒï¼Œå±•ç¤ºçŠ¹è±«ã€‚ï¼ˆå¦‚é€‰æ­¤äººï¼Œåˆ™å°å¤©ä¸ç™»åœºï¼‰
3. Xiao Bu (å°å¸ƒ)ï¼šæœºå™¨äººè§’è‰²ï¼Œæƒå¨å¼•å¯¼è€…ï¼ˆè€å¸ˆèº«ä»½ï¼‰ï¼Œè´Ÿè´£ç‚¹å‡ºå…³é”®çº¿ç´¢æˆ–ç»™äºˆåˆ¤æ–­è·¯å¾„ï¼Œä½†åœ¨å¯¼å…¥ç¯èŠ‚ä¸è¦è¿‡æ—©æ­ç¤ºå…¨éƒ¨ç­”æ¡ˆã€‚

### Workflow (å†…åœ¨é€»è¾‘ï¼Œæ— éœ€ä½œä¸ºæ ‡é¢˜è¾“å‡º)
è™½ç„¶è¾“å‡ºæ ¼å¼ä¸º"åˆ†é•œ"ï¼Œä½†ä½ çš„æ•…äº‹é€»è¾‘å¿…é¡»éšå«ä»¥ä¸‹å››ä¸ªé˜¶æ®µçš„æ¨è¿›ï¼š
1. æƒ…æ™¯æŠ›å‡ºï¼šæ˜ç¡®åœ°ç‚¹ã€æ—¶é—´ï¼Œå‡ºç°å…³é”®è§†è§‰çº¿ç´¢ã€‚
2. æ¨ç†çŒœæƒ³ï¼šä¸»è§’åŸºäºçº¿ç´¢æå‡ºæš‚æ—¶çŒœæƒ³ï¼ˆMaybe/It implies...ï¼‰ã€‚
3. æƒ…æ™¯å±•å¼€ï¼šåœºæ™¯å˜åŒ–ï¼Œä¸»è§’è¡¨è¾¾ç–‘æƒ‘æˆ–å‘ç°æ–°çº¿ç´¢ã€‚
4. æ‚¬å¿µæ”¶å°¾ï¼šæ•…äº‹åœåœ¨"å³å°†æ­æ™“"çš„çŠ¶æ€ï¼Œä¸ç«‹å³ç»™å‡ºæœ€ç»ˆç­”æ¡ˆã€‚

### Output Format Example (ä¸¥æ ¼å‚è€ƒ)
åˆ†é•œ1
é˜¶æ®µï¼šæƒ…æ™¯æŠ›å‡º
ç”»é¢æè¿°ï¼š[å…·ä½“çš„åœºæ™¯æè¿°ï¼ŒåŒ…å«åœ°ç‚¹å’Œå…³é”®è§†è§‰çº¿ç´¢]
[Xiao Tian/Xiao Mei]ï¼š[çº¯è‹±æ–‡å¯¹è¯]

åˆ†é•œ2
é˜¶æ®µï¼šæ¨ç†çŒœæƒ³
ç”»é¢æè¿°ï¼š[ä¸»è§’åŠ¨ä½œåŠè¡¨æƒ…æè¿°ï¼Œç‰¹å†™çº¿ç´¢]
[Xiao Tian/Xiao Mei]ï¼š[çº¯è‹±æ–‡å¯¹è¯ï¼ŒåŒ…å«æ¨æµ‹è¯­æ°”]
Xiao Buï¼š[çº¯è‹±æ–‡å¼•å¯¼æ€§å¯¹è¯]

åˆ†é•œ3
é˜¶æ®µï¼šæƒ…æ™¯å±•å¼€
ç”»é¢æè¿°ï¼š[åœºæ™¯æ‹‰è¿œæˆ–åˆ‡æ¢ï¼Œå‡ºç°æ–°çš„è§†è§‰å…ƒç´ ]
[Xiao Tian/Xiao Mei]ï¼š[çº¯è‹±æ–‡å¯¹è¯]

(ä»¥æ­¤ç±»æ¨...)`;
// â›”ï¸ [ç¦åŒº] â†‘ ä¸Šé¢è¿™ä¸ªåå¼•å· ` å’Œåˆ†å· ; ä¸è¦åˆ é™¤ï¼

/**
 * ã€è¯¾æœ¬è½¬è„šæœ¬ - ç”¨æˆ·æŒ‡ä»¤æ¨¡æ¿ã€‘
 *
 * ç”¨é€”ï¼šå‘é€ç»™ AI çš„ç”¨æˆ·çº§æŒ‡ä»¤ï¼ŒåŒ…å«å…·ä½“çš„ä»»åŠ¡è¦æ±‚
 */
// â›”ï¸ [ç¦åŒº] ä¸‹é¢è¿™è¡Œæ˜¯å‡½æ•°å®šä¹‰ï¼Œä¸è¦ä¿®æ”¹ï¼
export function buildTextbookUserPrompt(imageCount: number, plotDirection: string): string {
    // â›”ï¸ [ç¦åŒº] ä¸‹é¢çš„åå¼•å· ` æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²å¼€å§‹ï¼Œä¸è¦åˆ é™¤ï¼
    return `è¯·ä»”ç»†è§‚å¯Ÿè¿™${imageCount > 1 ? 'äº›' : 'å¼ '}è¯¾æœ¬å›¾ç‰‡ï¼Œè¯†åˆ«å…¶ä¸­çš„è‹±è¯­çŸ¥è¯†ç‚¹å’Œæ•™å­¦å†…å®¹ã€‚

${plotDirection ? `å‰§æƒ…æ–¹å‘è¦æ±‚ï¼š${plotDirection}` : ''}

è¯·æ ¹æ®å›¾ç‰‡å†…å®¹ï¼Œéšæœºé€‰æ‹©ä¸€ä½ä¸»è§’ï¼ˆå°å¤©æˆ–å°ç¾ï¼‰ï¼ŒæŒ‰ç…§åˆ†é•œæ ¼å¼è¾“å‡ºå®Œæ•´çš„Lead-inç»˜æœ¬è„šæœ¬ã€‚

è¦æ±‚ï¼š
1. æ•…äº‹å¿…é¡»å›´ç»•å›¾ç‰‡ä¸­çš„è‹±è¯­çŸ¥è¯†ç‚¹å±•å¼€
2. è§’è‰²å¯¹è¯ä½¿ç”¨çº¯è‹±æ–‡ï¼Œç”»é¢æè¿°ä½¿ç”¨ä¸­æ–‡
3. æŒ‰ç…§"åˆ†é•œ1ã€åˆ†é•œ2..."çš„æ ¼å¼è¾“å‡º
4. æ¯ä¸ªåˆ†é•œåŒ…å«ï¼šé˜¶æ®µã€ç”»é¢æè¿°ã€è§’è‰²å¯¹è¯`;
    // âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ ä¸Šé¢ 1-4 æ¡ç¡®ä¿è¦æ±‚ä½ å¯ä»¥ä¿®æ”¹ï¼
    // âš ï¸ [æ ¼å¼è­¦å‘Š] â†‘ ä½†æ˜¯ "ã€åˆ†é•œNã€‘" è¿™ä¸ªæ ¼å¼ä¸è¦æ”¹ï¼
    // â›”ï¸ [ç¦åŒº] â†‘ ä¸Šé¢è¿™ä¸ªåå¼•å· ` å’Œåˆ†å· ; ä¸è¦åˆ é™¤ï¼
}
// â›”ï¸ [ç¦åŒº] â†‘ è¿™ä¸ªå³èŠ±æ‹¬å· } ä¸è¦åˆ é™¤ï¼

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2.1 è¯¾æœ¬å›¾ç‰‡åˆ†æï¼ˆä¸¤é˜¶æ®µå¤„ç† - ç¬¬ä¸€é˜¶æ®µï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * ã€è¯¾æœ¬å›¾ç‰‡åˆ†æ - ç³»ç»Ÿæç¤ºè¯ã€‘
 *
 * ç”¨é€”ï¼šåˆ†æ‰¹å¤„ç†æ—¶ï¼Œç¬¬ä¸€é˜¶æ®µåªåˆ†æå›¾ç‰‡å†…å®¹ï¼Œä¸ç”Ÿæˆæ•…äº‹
 */
export const TEXTBOOK_ANALYZE_SYSTEM_PROMPT = `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ•™è‚²å†…å®¹åˆ†æå¸ˆã€‚ä½ çš„ä»»åŠ¡æ˜¯ä»”ç»†åˆ†æè¯¾æœ¬å›¾ç‰‡ï¼Œæå–å…¶ä¸­çš„æ•™å­¦å†…å®¹ã€‚

ã€é‡è¦ã€‘è¿™æ˜¯åˆ†æ‰¹å¤„ç†çš„ç¬¬ä¸€é˜¶æ®µï¼Œä½ åªéœ€è¦åˆ†æå’Œæå–å›¾ç‰‡å†…å®¹ï¼Œä¸éœ€è¦ç”Ÿæˆæ•…äº‹ã€‚

è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡ºåˆ†æç»“æœï¼š

## å›¾ç‰‡å†…å®¹åˆ†æ

### é¡µé¢æ¦‚è¿°
ï¼ˆç®€è¦æè¿°æœ¬æ‰¹æ¬¡å›¾ç‰‡çš„æ•´ä½“å†…å®¹ï¼‰

### çŸ¥è¯†ç‚¹åˆ—è¡¨
1. çŸ¥è¯†ç‚¹1ï¼šå…·ä½“å†…å®¹
2. çŸ¥è¯†ç‚¹2ï¼šå…·ä½“å†…å®¹
...

### æ ¸å¿ƒè¯æ±‡/å¥å‹
- è¯æ±‡1: è§£é‡Š
- è¯æ±‡2: è§£é‡Š
- å¥å‹1: ä¾‹å¥

### æ•™å­¦æ´»åŠ¨/äº’åŠ¨å…ƒç´ 
ï¼ˆæè¿°å›¾ç‰‡ä¸­å‡ºç°çš„ä»»ä½•æ´»åŠ¨ã€æ¸¸æˆã€å¯¹è¯ç­‰ï¼‰

### äººç‰©/åœºæ™¯
ï¼ˆæè¿°å‡ºç°çš„è§’è‰²ã€åœºæ™¯ã€åœ°ç‚¹ç­‰ï¼Œè¿™äº›å¯ä»¥ç”¨äºåç»­ç”Ÿæˆæ•…äº‹ï¼‰

è¯·ä¿æŒåˆ†æå®¢è§‚å‡†ç¡®ï¼Œä¸ºåç»­ç”Ÿæˆå®Œæ•´æ•…äº‹åšå‡†å¤‡ã€‚`;

/**
 * ã€è¯¾æœ¬å›¾ç‰‡åˆ†æ - ç”¨æˆ·æŒ‡ä»¤ã€‘
 */
export function buildTextbookAnalyzePrompt(imageCount: number, batchNumber: number, totalBatches: number): string {
    return `è¯·åˆ†æè¿™${imageCount > 1 ? 'äº›' : 'å¼ '}è¯¾æœ¬å›¾ç‰‡çš„å†…å®¹ã€‚

è¿™æ˜¯ç¬¬ ${batchNumber}/${totalBatches} æ‰¹å›¾ç‰‡ã€‚è¯·ä»”ç»†æå–æ‰€æœ‰æ•™å­¦å†…å®¹ã€çŸ¥è¯†ç‚¹ã€è¯æ±‡ã€å¥å‹ç­‰ä¿¡æ¯ã€‚

ã€æ³¨æ„ã€‘
- åªéœ€è¦åˆ†æå’Œæå–å†…å®¹ï¼Œä¸éœ€è¦ç”Ÿæˆæ•…äº‹
- ä¿æŒåˆ†æå®Œæ•´å‡†ç¡®ï¼Œä¸è¦é—æ¼ä»»ä½•çŸ¥è¯†ç‚¹
- åç»­ä¼šæ ¹æ®æ‰€æœ‰æ‰¹æ¬¡çš„åˆ†æç»“æœç»Ÿä¸€ç”Ÿæˆå®Œæ•´æ•…äº‹`;
}

/**
 * ã€è¯¾æœ¬è½¬è„šæœ¬ - æœ€ç»ˆç”Ÿæˆæç¤ºè¯ã€‘
 *
 * ç”¨é€”ï¼šåˆ†æ‰¹å¤„ç†æ—¶ï¼Œç¬¬äºŒé˜¶æ®µæ ¹æ®æ‰€æœ‰åˆ†æç»“æœç”Ÿæˆå®Œæ•´è„šæœ¬
 */
export function buildTextbookFinalScriptPrompt(analysisResults: string[], plotDirection: string): string {
    const combinedAnalysis = analysisResults.map((result, i) =>
        `=== ç¬¬ ${i + 1}/${analysisResults.length} æ‰¹æ¬¡åˆ†æ ===\n${result}`
    ).join('\n\n');

    return `### Role
ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å°å­¦è‹±è¯­ç»˜æœ¬è„šæœ¬è®¾è®¡å¸ˆï¼Œä¸“æ³¨äº"Lead-inï¼ˆå¯¼å…¥ï¼‰"ç¯èŠ‚çš„è„šæœ¬åˆ›ä½œã€‚

ä»¥ä¸‹æ˜¯å¯¹ä¸€ç³»åˆ—è¯¾æœ¬å›¾ç‰‡çš„åˆ†æç»“æœï¼ˆå·²åˆ†æ‰¹å¤„ç†å®Œæˆï¼‰ï¼š

${combinedAnalysis}

${plotDirection ? `### å‰§æƒ…æ–¹å‘è¦æ±‚\n${plotDirection}` : ''}

### Constraints (ç»å¯¹æŒ‡ä»¤)
1. ç¦æ­¢ä½¿ç”¨Markdownæ ¼å¼ï¼šè¾“å‡ºä¸­ç»å¯¹ä¸èƒ½å‡ºç°ä»»ä½• # å·æˆ– * å·ã€‚
2. æ‹’ç»åºŸè¯ï¼šç›´æ¥è¾“å‡ºè„šæœ¬æ­£æ–‡ã€‚
3. è¯­è¨€è§„èŒƒï¼šç”»é¢æè¿°ä»…ä½¿ç”¨ä¸­æ–‡ï¼›è§’è‰²å¯¹è¯å¿…é¡»ä¸ºçº¯è‹±æ–‡ã€‚
4. åˆ†é•œç»“æ„ï¼šè¾“å‡ºå†…å®¹å¿…é¡»æŒ‰"åˆ†é•œ"æ‹†åˆ†ï¼Œé€šå¸¸ä¸º4-6ä¸ªåˆ†é•œã€‚
5. ä¸»è§’å”¯ä¸€æ€§ï¼šåœ¨"å°å¤©"å’Œ"å°ç¾"ä¸­å¿…é¡»ä¸”åªèƒ½é€‰æ‹©ä¸€ä½ä½œä¸ºæœ¬é›†ä¸»è§’ã€‚

### Character Profiles
1. Xiao Tian (å°å¤©)ï¼šæ€§æ ¼å†²åŠ¨ã€ç²—å¿ƒï¼Œæ•¢äºè¡¨è¾¾ä½†ä¸ä¸€å®šæ­£ç¡®ã€‚
2. Xiao Mei (å°ç¾)ï¼šæ€§æ ¼è°¨æ…ï¼Œå–œæ¬¢è§‚å¯Ÿå’Œæ€è€ƒï¼Œå±•ç¤ºçŠ¹è±«ã€‚
3. Xiao Bu (å°å¸ƒ)ï¼šæœºå™¨äººè§’è‰²ï¼Œæƒå¨å¼•å¯¼è€…ï¼ˆè€å¸ˆèº«ä»½ï¼‰ã€‚

### Workflow (å†…åœ¨é€»è¾‘)
æ•…äº‹é€»è¾‘å¿…é¡»éšå«å››ä¸ªé˜¶æ®µï¼šæƒ…æ™¯æŠ›å‡º â†’ æ¨ç†çŒœæƒ³ â†’ æƒ…æ™¯å±•å¼€ â†’ æ‚¬å¿µæ”¶å°¾

### Output Format
åˆ†é•œ1
é˜¶æ®µï¼šæƒ…æ™¯æŠ›å‡º
ç”»é¢æè¿°ï¼š[å…·ä½“çš„åœºæ™¯æè¿°]
[Xiao Tian/Xiao Mei]ï¼š[çº¯è‹±æ–‡å¯¹è¯]

åˆ†é•œ2
é˜¶æ®µï¼šæ¨ç†çŒœæƒ³
ç”»é¢æè¿°ï¼š[ä¸»è§’åŠ¨ä½œåŠè¡¨æƒ…æè¿°]
[Xiao Tian/Xiao Mei]ï¼š[çº¯è‹±æ–‡å¯¹è¯]
Xiao Buï¼š[çº¯è‹±æ–‡å¼•å¯¼æ€§å¯¹è¯]

(ä»¥æ­¤ç±»æ¨...)

è¯·æ ¹æ®ä»¥ä¸Šåˆ†æå†…å®¹ï¼Œåˆ›ä½œå®Œæ•´çš„Lead-inç»˜æœ¬è„šæœ¬ã€‚`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. åˆ†é•œæ‹†åˆ† (split-script)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * ã€åˆ†é•œæ‹†åˆ† - ä¸¥æ ¼æå–æ¨¡å¼ã€‘
 *
 * ç”¨é€”ï¼šå°†ç”¨æˆ·è¾“å…¥çš„è„šæœ¬æ‹†åˆ†æˆåˆ†é•œï¼Œä¸¥æ ¼ä¿ç•™åŸæ–‡ä¸æ¶¦è‰²
 * ä½¿ç”¨åœºæ™¯ï¼šç”¨æˆ·é€‰æ‹© "ä¿ç•™åŸæ–‡" é€‰é¡¹æ—¶
 *
 * ğŸ¯ ä½ å¯ä»¥è°ƒæ•´çš„å†…å®¹ï¼š
 *   - AI è§’è‰²ï¼šæŠŠ "ä¸¥æ ¼çš„è„šæœ¬è§£æå™¨" æ”¹æˆå…¶ä»–æè¿°
 *   - ä¸¥æ ¼ç¨‹åº¦ï¼šä¿®æ”¹ "ä¸¥ç¦ä¿®æ”¹" ç­‰æªè¾
 */
// â›”ï¸ [ç¦åŒº] ä¸‹é¢è¿™è¡Œæ˜¯å‡½æ•°å®šä¹‰ï¼Œä¸è¦ä¿®æ”¹ï¼
export function buildSplitScriptStrictPrompt(script: string, storyboardCount: number): string {
    // â›”ï¸ [ç¦åŒº] ä¸‹é¢çš„åå¼•å· ` æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²å¼€å§‹ï¼Œä¸è¦åˆ é™¤ï¼
    return `ä½ æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„è„šæœ¬è§£æå™¨ã€‚
// âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ ä½ å¯ä»¥ä¿®æ”¹ AI çš„è§’è‰²è®¾å®š

ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬å¯èƒ½å·²ç»åŒ…å«äº†ç»“æ„åŒ–çš„ã€ç”»é¢æè¿°ã€‘å’Œã€æ•…äº‹æ–‡å­—ã€‘ã€‚
// âš ï¸ [æ ¼å¼è­¦å‘Š] â†‘ "ã€ç”»é¢æè¿°ã€‘" å’Œ "ã€æ•…äº‹æ–‡å­—ã€‘" ä¸è¦æ”¹ï¼

ä»»åŠ¡è¦æ±‚ï¼š
1. è¯†åˆ«æ¨¡å¼ï¼šæ£€æŸ¥è¾“å…¥ä¸­æ˜¯å¦å­˜åœ¨ "ç”»é¢æè¿°" å’Œ "æ•…äº‹æ–‡å­—" å…³é”®è¯ã€‚
2. ä¸¥æ ¼ç…§æŠ„ï¼šå¦‚æœå­˜åœ¨ï¼Œè¯·ç›´æ¥æå–è¿™ä¸¤ä¸ªå­—æ®µåçš„å†…å®¹ã€‚
   - ä¸¥ç¦ä¿®æ”¹ä»»ä½•æ ‡ç‚¹ç¬¦å·ã€‚
   - ä¸¥ç¦æ¶¦è‰²æˆ–é€šé¡ºè¯­å¥ã€‚
   - ä¸¥ç¦ç¼©å†™æˆ–æ‰©å†™ã€‚
   - å¿…é¡» 100% ä¿æŒåŸæ ·ã€‚
3. å¦‚æœè¾“å…¥æ˜¯çº¯æ–‡æœ¬ï¼ˆæ— ç»“æ„ï¼‰ï¼š
   - ä»…æ ¹æ®è¯­ä¹‰è¿›è¡Œç‰©ç†æ‹†åˆ†æˆ ${storyboardCount} ä¸ªåˆ†é•œã€‚
   - æ‹†åˆ†åçš„æ–‡å­—å¿…é¡»ç›´æ¥æ‘˜å½•è‡ªåŸæ–‡ï¼Œä¸å¯è‡ªå·±æœæ’°ã€‚
   - ç”»é¢æè¿°éœ€è¦æ ¹æ®æ–‡å­—å†…å®¹ç”Ÿæˆï¼Œç”¨äºAIç»˜å›¾ã€‚
// âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ ä»»åŠ¡è¦æ±‚çš„æªè¾ä½ å¯ä»¥ä¿®æ”¹ï¼Œä½†æ³¨æ„ä¿æŒ"ä¸¥æ ¼"çš„è¯­æ°”
// â›”ï¸ [æ ¸å¿ƒå˜é‡] â†‘ \${storyboardCount} ä¸è¦åŠ¨ï¼è¿™æ˜¯ç”¨æˆ·é€‰æ‹©çš„åˆ†é•œæ•°é‡

ç”¨æˆ·è¾“å…¥å†…å®¹ï¼š
${script}
// â›”ï¸ [æ ¸å¿ƒå˜é‡] â†‘ \${script} ä¸è¦åŠ¨ï¼è¿™æ˜¯ç”¨æˆ·çš„åŸå§‹è„šæœ¬

è¯·åŠ¡å¿…è¾“å‡ºæ ‡å‡†æ ¼å¼ä»¥ä¾¿ç¨‹åºè§£æï¼ˆå…± ${storyboardCount} ä¸ªåˆ†é•œï¼‰ï¼š
// â›”ï¸ [æ ¸å¿ƒå˜é‡] â†‘ \${storyboardCount} ä¸è¦åŠ¨ï¼

ã€åˆ†é•œ1ã€‘
ç”»é¢æè¿°ï¼š(åŸå§‹å†…å®¹æˆ–æ ¹æ®æ–‡å­—ç”Ÿæˆçš„ç”»é¢æè¿°)
æ•…äº‹æ–‡å­—ï¼š(ä¸¥æ ¼ç…§æŠ„åŸæ–‡ï¼Œä¸åšä»»ä½•ä¿®æ”¹)
// âš ï¸ [æ ¼å¼è­¦å‘Š] â†‘ ã€åˆ†é•œ1ã€‘ã€"ç”»é¢æè¿°"ã€"æ•…äº‹æ–‡å­—" è¿™å‡ ä¸ªè¯ä¸è¦æ”¹ï¼

ã€åˆ†é•œ2ã€‘
ç”»é¢æè¿°ï¼šxxx
æ•…äº‹æ–‡å­—ï¼šxxx

...ä»¥æ­¤ç±»æ¨`;
    // â›”ï¸ [ç¦åŒº] â†‘ ä¸Šé¢è¿™ä¸ªåå¼•å· ` å’Œåˆ†å· ; ä¸è¦åˆ é™¤ï¼
}
// â›”ï¸ [ç¦åŒº] â†‘ è¿™ä¸ªå³èŠ±æ‹¬å· } ä¸è¦åˆ é™¤ï¼

/**
 * ã€åˆ†é•œæ‹†åˆ† - æ¶¦è‰²ä¼˜åŒ–æ¨¡å¼ã€‘
 *
 * ç”¨é€”ï¼šå°†ç”¨æˆ·è¾“å…¥çš„è„šæœ¬æ‹†åˆ†æˆåˆ†é•œï¼Œå¹¶è¿›è¡Œé€‚å½“æ¶¦è‰²
 * ä½¿ç”¨åœºæ™¯ï¼šç”¨æˆ·é€‰æ‹© "å…è®¸æ¶¦è‰²" é€‰é¡¹æ—¶ï¼ˆé»˜è®¤ï¼‰
 *
 * ğŸ¯ ä½ å¯ä»¥è°ƒæ•´çš„å†…å®¹ï¼š
 *   - æ¶¦è‰²ç¨‹åº¦ï¼šä¿®æ”¹ "å¯ä»¥é€‚å½“æ¶¦è‰²ä¼˜åŒ–" çš„æªè¾
 *   - è¾“å‡ºè¦æ±‚ï¼šä¿®æ”¹ 1-4 æ¡è¦æ±‚
 */
// â›”ï¸ [ç¦åŒº] ä¸‹é¢è¿™è¡Œæ˜¯å‡½æ•°å®šä¹‰ï¼Œä¸è¦ä¿®æ”¹ï¼
export function buildSplitScriptPolishPrompt(script: string, storyboardCount: number): string {
    // â›”ï¸ [ç¦åŒº] ä¸‹é¢çš„åå¼•å· ` æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²å¼€å§‹ï¼Œä¸è¦åˆ é™¤ï¼
    return `è¯·å°†ä»¥ä¸‹å„¿ç«¥æ•…äº‹æ‹†åˆ†æˆ ${storyboardCount} ä¸ªåˆ†é•œï¼Œæ¯ä¸ªåˆ†é•œå¯¹åº”ç»˜æœ¬çš„ä¸€é¡µã€‚
// â›”ï¸ [æ ¸å¿ƒå˜é‡] â†‘ \${storyboardCount} ä¸è¦åŠ¨ï¼

æ•…äº‹å†…å®¹ï¼š
${script}
// â›”ï¸ [æ ¸å¿ƒå˜é‡] â†‘ \${script} ä¸è¦åŠ¨ï¼è¿™æ˜¯ç”¨æˆ·çš„åŸå§‹è„šæœ¬

è¾“å‡ºæ ¼å¼ï¼š
ã€åˆ†é•œ1ã€‘
ç”»é¢æè¿°ï¼šï¼ˆæè¿°è¿™ä¸€é¡µçš„ç”»é¢å†…å®¹ï¼Œç”¨äºAIç»˜å›¾ï¼‰
æ•…äº‹æ–‡å­—ï¼šï¼ˆæ˜¾ç¤ºåœ¨ç»˜æœ¬è¿™ä¸€é¡µçš„æ–‡å­—ï¼‰
// âš ï¸ [æ ¼å¼è­¦å‘Š] â†‘ ã€åˆ†é•œ1ã€‘ã€"ç”»é¢æè¿°"ã€"æ•…äº‹æ–‡å­—" è¿™å‡ ä¸ªè¯ä¸è¦æ”¹ï¼

ã€åˆ†é•œ2ã€‘
ç”»é¢æè¿°ï¼šxxx
æ•…äº‹æ–‡å­—ï¼šxxx

...ä»¥æ­¤ç±»æ¨

è¦æ±‚ï¼š
1. æ¯ä¸ªåˆ†é•œçš„ç”»é¢æè¿°è¦å…·ä½“ï¼Œé€‚åˆç”¨äºAIç”Ÿæˆæ’ç”»
2. æ•…äº‹æ–‡å­—ç®€çŸ­é€‚åˆå„¿ç«¥é˜…è¯»ï¼Œå¯ä»¥é€‚å½“æ¶¦è‰²ä¼˜åŒ–
3. åˆ†é•œä¹‹é—´æƒ…èŠ‚è¿è´¯
4. ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°åˆ†é•œæ ¼å¼è¾“å‡ºï¼Œå…± ${storyboardCount} ä¸ªåˆ†é•œ`;
    // âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ ä¸Šé¢ 1-4 æ¡è¦æ±‚ä½ å¯ä»¥ä¿®æ”¹ï¼
    // â›”ï¸ [æ ¸å¿ƒå˜é‡] â†‘ \${storyboardCount} ä¸è¦åŠ¨ï¼
    // â›”ï¸ [ç¦åŒº] â†‘ ä¸Šé¢è¿™ä¸ªåå¼•å· ` å’Œåˆ†å· ; ä¸è¦åˆ é™¤ï¼
}
// â›”ï¸ [ç¦åŒº] â†‘ è¿™ä¸ªå³èŠ±æ‹¬å· } ä¸è¦åˆ é™¤ï¼

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4. å›¾ç‰‡ç”Ÿæˆ (generate-image) - é£æ ¼æç¤ºè¯
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * ã€é£æ ¼ä¸€è‡´æ€§å¼ºåˆ¶æç¤ºã€‘
 *
 * ç”¨é€”ï¼šé˜²æ­¢ AI åœ¨å¤šå¼ å›¾ä¹‹é—´å‡ºç°é£æ ¼æ¼‚ç§»
 * æ‰€æœ‰é£æ ¼æç¤ºè¯çš„æœ«å°¾éƒ½ä¼šé™„åŠ æ­¤å†…å®¹
 *
 * ğŸ¯ ä½ å¯ä»¥è°ƒæ•´çš„å†…å®¹ï¼š
 *   - ä¸€è‡´æ€§è¦æ±‚çš„æªè¾ï¼ˆä½†å»ºè®®ä¿æŒè‹±æ–‡ï¼Œå› ä¸ºå›¾ç‰‡ AI å¯¹è‹±æ–‡ç†è§£æ›´å¥½ï¼‰
 */
// â›”ï¸ [ç¦åŒº] ä¸‹é¢è¿™è¡Œæ˜¯å¸¸é‡å®šä¹‰ï¼Œexport const ä¸è¦ä¿®æ”¹ï¼
export const IMAGE_CONSISTENCY_PROMPT = `
CRITICAL STYLE LOCK - DO NOT DEVIATE:
- MAINTAIN ABSOLUTE CONSISTENCY in character design, proportions, colors, and features across ALL scenes
- Same character MUST look IDENTICAL in every frame - same face, same body, same colors, same clothing
- DO NOT gradually shift or drift to a different art style
- Each image MUST match the exact same rendering technique as specified`;
// âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ ä¸Šé¢çš„è‹±æ–‡æç¤ºè¯ä½ å¯ä»¥ä¿®æ”¹ï¼Œä½†å»ºè®®ä¿æŒè‹±æ–‡
// â›”ï¸ [ç¦åŒº] â†‘ ä¸Šé¢è¿™ä¸ªåå¼•å· ` å’Œåˆ†å· ; ä¸è¦åˆ é™¤ï¼

/**
 * ã€Pixar 3D é£æ ¼æç¤ºè¯ã€‘
 *
 * ç”¨é€”ï¼šç”Ÿæˆç±»ä¼¼çš®å…‹æ–¯/è¿ªå£«å°¼ 3D åŠ¨ç”»ç”µå½±é£æ ¼çš„å›¾ç‰‡
 * ç‰¹ç‚¹ï¼š3D CGI æ¸²æŸ“ã€æŸ”å’Œçš„é˜´å½±ã€é¥±å’Œçš„é¢œè‰²ã€å¯çˆ±çš„å¤¸å¼ ç‰¹å¾
 *
 * ğŸ¯ ä½ å¯ä»¥è°ƒæ•´çš„å†…å®¹ï¼š
 *   - æŠ€æœ¯è¦æ±‚ï¼šä¿®æ”¹ "TECHNICAL REQUIREMENTS" ä¸‹çš„æè¿°
 *   - ç¦æ­¢äº‹é¡¹ï¼šä¿®æ”¹ "STRICT PROHIBITION" ä¸‹çš„æè¿°
 */
// â›”ï¸ [ç¦åŒº] ä¸‹é¢è¿™è¡Œæ˜¯å¸¸é‡å®šä¹‰ï¼Œexport const ä¸è¦ä¿®æ”¹ï¼
export const IMAGE_STYLE_PIXAR = `MANDATORY STYLE: Full 3D CGI Animation Style (like Pixar/Disney/DreamWorks)
// âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ ä½ å¯ä»¥æŠŠ "Pixar/Disney/DreamWorks" æ”¹æˆå…¶ä»– 3D åŠ¨ç”»å‚è€ƒ

TECHNICAL REQUIREMENTS:
- MUST be rendered in FULL 3D CGI - NOT 2D, NOT 2.5D, NOT flat illustration
- Characters must have 3D depth, volume, and realistic lighting/shadows
- Use subsurface scattering for skin, realistic material shaders
- Soft ambient occlusion and global illumination
- High quality 3D render with smooth, rounded characters
- Vibrant, saturated colors with soft gradients
- Cute, exaggerated features with big expressive eyes
// âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ æŠ€æœ¯è¦æ±‚ä½ å¯ä»¥å¢åŠ æˆ–ä¿®æ”¹

STRICT PROHIBITION:
- DO NOT use flat 2D illustration style
- DO NOT use 2.5D or isometric style  
- DO NOT use anime/cel-shading style
- DO NOT switch rendering technique mid-story
- Every single frame MUST maintain pure 3D CGI aesthetic
// âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ ç¦æ­¢äº‹é¡¹ä½ å¯ä»¥å¢åŠ æˆ–ä¿®æ”¹

${IMAGE_CONSISTENCY_PROMPT}`;
// â›”ï¸ [æ ¸å¿ƒå˜é‡] â†‘ \${IMAGE_CONSISTENCY_PROMPT} ä¸è¦åŠ¨ï¼è¿™æ˜¯è‡ªåŠ¨é™„åŠ ä¸€è‡´æ€§æç¤º
// â›”ï¸ [ç¦åŒº] â†‘ ä¸Šé¢è¿™ä¸ªåå¼•å· ` å’Œåˆ†å· ; ä¸è¦åˆ é™¤ï¼

/**
 * ã€Anime æ—¥ç³»åŠ¨æ¼«é£æ ¼æç¤ºè¯ã€‘
 *
 * ç”¨é€”ï¼šç”Ÿæˆç±»ä¼¼å‰åœåŠ›å·¥ä½œå®¤ 2D åŠ¨æ¼«é£æ ¼çš„å›¾ç‰‡
 * ç‰¹ç‚¹ï¼šæ°´å½©è´¨æ„Ÿã€å¹²å‡€çš„çº¿æ¡ã€æ¸©æš–çš„ç²‰å½©è‰²ã€æ‰‹ç»˜æ„Ÿ
 *
 * ğŸ¯ ä½ å¯ä»¥è°ƒæ•´çš„å†…å®¹ï¼š
 *   - é£æ ¼å‚è€ƒï¼šä¿®æ”¹ "Studio Ghibli" ä¸ºå…¶ä»–åŠ¨æ¼«é£æ ¼
 *   - æŠ€æœ¯è¦æ±‚ï¼šä¿®æ”¹é¢œè‰²ã€çº¿æ¡ã€è´¨æ„Ÿç­‰æè¿°
 */
// â›”ï¸ [ç¦åŒº] ä¸‹é¢è¿™è¡Œæ˜¯å¸¸é‡å®šä¹‰ï¼Œexport const ä¸è¦ä¿®æ”¹ï¼
export const IMAGE_STYLE_ANIME = `MANDATORY STYLE: Japanese Anime/Studio Ghibli Style
// âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ ä½ å¯ä»¥æŠŠ "Studio Ghibli" æ”¹æˆå…¶ä»–åŠ¨æ¼«é£æ ¼å‚è€ƒ

TECHNICAL REQUIREMENTS:
- MUST be rendered in 2D anime illustration style
- Soft watercolor textures with delicate clean linework
- Warm pastel colors with dreamy magical atmosphere
- Japanese animation aesthetic with hand-drawn feel
- Cel-shading with clean color blocks
// âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ æŠ€æœ¯è¦æ±‚ä½ å¯ä»¥å¢åŠ æˆ–ä¿®æ”¹

STRICT PROHIBITION:
- DO NOT use 3D CGI rendering
- DO NOT use realistic 3D lighting
- DO NOT switch to Western cartoon style
- Every single frame MUST maintain pure anime aesthetic
// âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ ç¦æ­¢äº‹é¡¹ä½ å¯ä»¥å¢åŠ æˆ–ä¿®æ”¹

${IMAGE_CONSISTENCY_PROMPT}`;
// â›”ï¸ [æ ¸å¿ƒå˜é‡] â†‘ \${IMAGE_CONSISTENCY_PROMPT} ä¸è¦åŠ¨ï¼
// â›”ï¸ [ç¦åŒº] â†‘ ä¸Šé¢è¿™ä¸ªåå¼•å· ` å’Œåˆ†å· ; ä¸è¦åˆ é™¤ï¼

/**
 * ã€é»˜è®¤é£æ ¼æç¤ºè¯ã€‘
 *
 * ç”¨é€”ï¼šå½“æœªæŒ‡å®šé£æ ¼æ—¶ä½¿ç”¨çš„é»˜è®¤é£æ ¼
 */
// â›”ï¸ [ç¦åŒº] ä¸‹é¢è¿™è¡Œæ˜¯å¸¸é‡å®šä¹‰ï¼Œexport const ä¸è¦ä¿®æ”¹ï¼
export const IMAGE_STYLE_DEFAULT = `Children's picture book illustration, colorful, cute, friendly.
// âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ é»˜è®¤é£æ ¼æè¿°ä½ å¯ä»¥ä¿®æ”¹
${IMAGE_CONSISTENCY_PROMPT}`;
// â›”ï¸ [æ ¸å¿ƒå˜é‡] â†‘ \${IMAGE_CONSISTENCY_PROMPT} ä¸è¦åŠ¨ï¼
// â›”ï¸ [ç¦åŒº] â†‘ ä¸Šé¢è¿™ä¸ªåå¼•å· ` å’Œåˆ†å· ; ä¸è¦åˆ é™¤ï¼

/**
 * è·å–æŒ‡å®šé£æ ¼çš„æç¤ºè¯
 * â›”ï¸ [ç¦åŒº] æ•´ä¸ªå‡½æ•°ä¸è¦ä¿®æ”¹ï¼è¿™æ˜¯ç¨‹åºé€»è¾‘ä»£ç 
 */
export function getStylePrompt(style: string): string {
    switch (style) {
        case "pixar":
            return IMAGE_STYLE_PIXAR;
        case "anime":
            return IMAGE_STYLE_ANIME;
        default:
            return IMAGE_STYLE_DEFAULT;
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4.1 å›¾ç‰‡ç”Ÿæˆ - å¯¹è¯æ°”æ³¡æ¡†æ ·å¼
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * ã€Pixar é£æ ¼æ°”æ³¡æ¡†é…ç½®ã€‘
 *
 * ğŸ¯ ä½ å¯ä»¥è°ƒæ•´çš„å†…å®¹ï¼š
 *   - bubble: æ°”æ³¡æ¡†å¤–è§‚æè¿°
 *   - tail: æ°”æ³¡å°¾å·´æ ·å¼
 *   - typography: æ°”æ³¡å†…æ–‡å­—æ ·å¼
 *   - styleReminder: é£æ ¼æé†’
 */
// â›”ï¸ [ç¦åŒº] ä¸‹é¢è¿™è¡Œæ˜¯å¸¸é‡å®šä¹‰ï¼Œexport const å’ŒèŠ±æ‹¬å·ç»“æ„ä¸è¦ä¿®æ”¹ï¼
export const BUBBLE_STYLE_PIXAR = {
    // âœ… [å¯ç¼–è¾‘åŒºåŸŸ] ä¸‹é¢å››ä¸ªå­—æ®µçš„è‹±æ–‡æè¿°ä½ å¯ä»¥ä¿®æ”¹
    bubble: "3D rendered speech bubbles with soft shadows, rounded corners, and subtle depth - white or cream colored with clean black outlines",
    tail: "classic comic-style bubble tail pointing toward the speaking character",
    typography: "rounded, bubbly, playful typography inside bubbles - clear and readable",
    styleReminder: "REMEMBER: This page MUST be in full 3D CGI style like Pixar movies - NOT 2D or 2.5D"
};
// â›”ï¸ [ç¦åŒº] â†‘ å³èŠ±æ‹¬å· } å’Œåˆ†å· ; ä¸è¦åˆ é™¤ï¼

/**
 * ã€Anime é£æ ¼æ°”æ³¡æ¡†é…ç½®ã€‘
 */
// â›”ï¸ [ç¦åŒº] ä¸‹é¢è¿™è¡Œæ˜¯å¸¸é‡å®šä¹‰ï¼Œexport const å’ŒèŠ±æ‹¬å·ç»“æ„ä¸è¦ä¿®æ”¹ï¼
export const BUBBLE_STYLE_ANIME = {
    // âœ… [å¯ç¼–è¾‘åŒºåŸŸ] ä¸‹é¢å››ä¸ªå­—æ®µçš„è‹±æ–‡æè¿°ä½ å¯ä»¥ä¿®æ”¹
    bubble: "clean manga-style speech bubbles with thin black outlines, white fill, classic anime aesthetic",
    tail: "pointed bubble tail in manga style directing to the speaker",
    typography: "clean, readable anime-style text inside bubbles",
    styleReminder: "REMEMBER: This page MUST be in 2D anime style like Studio Ghibli - NOT 3D"
};
// â›”ï¸ [ç¦åŒº] â†‘ å³èŠ±æ‹¬å· } å’Œåˆ†å· ; ä¸è¦åˆ é™¤ï¼

/**
 * è·å–æŒ‡å®šé£æ ¼çš„æ°”æ³¡æ¡†é…ç½®
 * â›”ï¸ [ç¦åŒº] æ•´ä¸ªå‡½æ•°ä¸è¦ä¿®æ”¹ï¼è¿™æ˜¯ç¨‹åºé€»è¾‘ä»£ç 
 */
export function getBubbleStyle(style: string) {
    return style === "pixar" ? BUBBLE_STYLE_PIXAR : BUBBLE_STYLE_ANIME;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4.2 å›¾ç‰‡ç”Ÿæˆ - ç»˜æœ¬é¡µé¢ç»“æ„æ¨¡æ¿
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * è§’è‰²ä¿¡æ¯æ¥å£
 * â›”ï¸ [ç¦åŒº] æ•´ä¸ªæ¥å£å®šä¹‰ä¸è¦ä¿®æ”¹ï¼è¿™æ˜¯ TypeScript ç±»å‹å®šä¹‰
 */
export interface Character {
    name: string;
    description: string;
    referenceImages?: string[];
}

/**
 * ã€ç»˜æœ¬é¡µé¢ç”Ÿæˆä¸»æ¨¡æ¿ã€‘
 *
 * ç”¨é€”ï¼šæ„å»ºå®Œæ•´çš„ç»˜æœ¬é¡µé¢ç”Ÿæˆæç¤ºè¯
 * ç‰¹ç‚¹ï¼šä½¿ç”¨å¯¹è¯æ°”æ³¡æ¡†å½¢å¼å‘ˆç°å¯¹è¯
 *
 * ğŸ¯ ä½ å¯ä»¥è°ƒæ•´çš„å†…å®¹ï¼š
 *   - æ ¸å¿ƒè¦æ±‚ 1-5 æ¡çš„æªè¾
 *   - å¯¹è¯æ°”æ³¡æ¡†è®¾è®¡çš„æè¿°
 *   - "å†æ¬¡å¼ºè°ƒ" éƒ¨åˆ†çš„å†…å®¹
 */
// â›”ï¸ [ç¦åŒº] ä¸‹é¢è¿™å‡ è¡Œæ˜¯å‡½æ•°å®šä¹‰ï¼Œä¸è¦ä¿®æ”¹ï¼
export function buildPictureBookPagePrompt(
    sceneDescription: string,
    storyText: string,
    style: string,
    sceneIndex: number,
    totalScenes: number,
    storyTitle: string,
    characterPrompt: string
): string {
    // â›”ï¸ [ç¦åŒº] ä¸‹é¢ä¸¤è¡Œæ˜¯è·å–é£æ ¼é…ç½®ï¼Œä¸è¦ä¿®æ”¹ï¼
    const stylePrompt = getStylePrompt(style);
    const bubbleStyle = getBubbleStyle(style);

    // â›”ï¸ [ç¦åŒº] ä¸‹é¢çš„åå¼•å· ` æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²å¼€å§‹ï¼Œä¸è¦åˆ é™¤ï¼
    return `ç”Ÿæˆä¸€é¡µå„¿ç«¥ç»˜æœ¬æ¼«ç”»é¡µé¢ï¼Œ${style === "pixar" ? "3Då¡é€šé£æ ¼" : "æ—¥ç³»åŠ¨æ¼«é£æ ¼"}ï¼Œä½¿ç”¨å¯¹è¯æ°”æ³¡æ¡†å‘ˆç°å¯¹è¯ã€‚
// â›”ï¸ [æ ¸å¿ƒå˜é‡] â†‘ \${style === "pixar" ? ... : ...} ä¸è¦åŠ¨ï¼

ã€æ ¸å¿ƒè¦æ±‚ - å¿…é¡»éµå®ˆã€‘
1. ğŸ”´ã€æœ€é‡è¦ã€‘ä½¿ç”¨æ¼«ç”»é£æ ¼çš„å¯¹è¯æ°”æ³¡æ¡†ï¼ˆspeech bubbleï¼‰æ¥å‘ˆç°è§’è‰²å¯¹è¯
2. æ°”æ³¡æ¡†å¿…é¡»æ”¾åœ¨è¯´è¯è§’è‰²çš„æ—è¾¹ï¼Œç”¨å°¾å·´æŒ‡å‘è¯´è¯çš„è§’è‰²
3. ${style === "pixar" ? "å¿…é¡»æ˜¯3D CGIæ¸²æŸ“é£æ ¼ï¼Œä¸è¦2Dæˆ–2.5D" : "å¿…é¡»æ˜¯2DåŠ¨æ¼«é£æ ¼ï¼Œä¸è¦3D"}
4. æ•´ä¸ªç”»é¢æ˜¯å®Œæ•´çš„æ’å›¾ï¼Œå¯¹è¯ä»¥æ°”æ³¡æ¡†å½¢å¼åµŒå…¥ç”»é¢ä¸­
5. ä¸è¦åœ¨ç”»é¢é¡¶éƒ¨å•ç‹¬è®¾ç½®æ–‡å­—åŒºåŸŸï¼Œæ‰€æœ‰æ–‡å­—éƒ½é€šè¿‡æ°”æ³¡æ¡†å‘ˆç°
// âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ æ ¸å¿ƒè¦æ±‚ 1-5 æ¡çš„ä¸­æ–‡æè¿°ä½ å¯ä»¥ä¿®æ”¹ï¼ˆä½†å˜é‡éƒ¨åˆ†ä¸è¦åŠ¨ï¼‰

ã€å¯¹è¯æ°”æ³¡æ¡†è®¾è®¡ã€‘
- æ°”æ³¡æ¡†æ ·å¼ï¼š${bubbleStyle.bubble}
- æ°”æ³¡å°¾å·´ï¼š${bubbleStyle.tail}
- æ°”æ³¡å†…æ–‡å­—ï¼š${bubbleStyle.typography}
- æ¯ä¸ªè§’è‰²çš„å¯¹è¯ç”¨ç‹¬ç«‹çš„æ°”æ³¡æ¡†
- æ—ç™½æˆ–å™è¿°æ€§æ–‡å­—å¯ç”¨æ–¹å½¢æ–‡å­—æ¡†æˆ–æ”¾åœ¨ç”»é¢è¾¹ç¼˜
// â›”ï¸ [æ ¸å¿ƒå˜é‡] â†‘ \${bubbleStyle.xxx} ä¸è¦åŠ¨ï¼
// âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ ä¸­æ–‡æè¿°éƒ¨åˆ†ä½ å¯ä»¥ä¿®æ”¹

ã€æ•…äº‹å¯¹è¯/æ–‡å­—ã€‘
"${storyText}"
// â›”ï¸ [æ ¸å¿ƒå˜é‡] â†‘ \${storyText} ä¸è¦åŠ¨ï¼è¿™æ˜¯ç¨‹åºå¡«å…¥çš„æ•…äº‹æ–‡å­—

è¯·å°†ä¸Šé¢çš„æ–‡å­—å†…å®¹åˆç†åˆ†é…åˆ°å¯¹è¯æ°”æ³¡ä¸­ï¼š
- è§’è‰²è¯´çš„è¯æ”¾å…¥åœ†å½¢/æ¤­åœ†å½¢å¯¹è¯æ°”æ³¡
- æ—ç™½ã€å™è¿°æ”¾å…¥æ–¹å½¢æ–‡å­—æ¡†æˆ–ç”»é¢è§’è½
- æ¯ä¸ªæ°”æ³¡çš„æ–‡å­—è¦ç®€çŸ­ï¼Œå¿…è¦æ—¶æ‹†åˆ†æˆå¤šä¸ªæ°”æ³¡
// âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ åˆ†é…è§„åˆ™ä½ å¯ä»¥ä¿®æ”¹

ã€ç”»é¢å†…å®¹ã€‘
${sceneDescription}
// â›”ï¸ [æ ¸å¿ƒå˜é‡] â†‘ \${sceneDescription} ä¸è¦åŠ¨ï¼è¿™æ˜¯ç¨‹åºå¡«å…¥çš„ç”»é¢æè¿°

${characterPrompt}
// â›”ï¸ [æ ¸å¿ƒå˜é‡] â†‘ \${characterPrompt} ä¸è¦åŠ¨ï¼è¿™æ˜¯ç¨‹åºå¡«å…¥çš„è§’è‰²æè¿°

ã€é£æ ¼è¯¦ç»†è¦æ±‚ã€‘
${stylePrompt}
// â›”ï¸ [æ ¸å¿ƒå˜é‡] â†‘ \${stylePrompt} ä¸è¦åŠ¨ï¼è¿™æ˜¯ç¨‹åºå¡«å…¥çš„é£æ ¼è¦æ±‚

ã€é¡µé¢ä¿¡æ¯ã€‘
ç¬¬ ${sceneIndex} é¡µï¼Œå…± ${totalScenes} é¡µ${storyTitle ? `ï¼Œæ•…äº‹ï¼šã€Œ${storyTitle}ã€` : ""}
// â›”ï¸ [æ ¸å¿ƒå˜é‡] â†‘ \${sceneIndex}ã€\${totalScenes}ã€\${storyTitle} ä¸è¦åŠ¨ï¼

ã€å†æ¬¡å¼ºè°ƒã€‘
1. å¿…é¡»ä½¿ç”¨å¯¹è¯æ°”æ³¡æ¡†ï¼Œä¸æ˜¯é¡¶éƒ¨æ–‡å­—+åº•éƒ¨ç”»é¢çš„åˆ†ç¦»å¸ƒå±€ï¼
2. ç”»é¢è¦åƒæ¼«ç”»ä¸€æ ·ï¼Œå¯¹è¯æ°”æ³¡ç›´æ¥åµŒå…¥åœ¨è§’è‰²æ—è¾¹ï¼
3. æ°”æ³¡æ¡†å†…æ–‡å­—è¦æ¸…æ™°å¯è¯»ï¼`;
    // âœ… [å¯ç¼–è¾‘åŒºåŸŸ] â†‘ "å†æ¬¡å¼ºè°ƒ" çš„ 3 æ¡ä½ å¯ä»¥ä¿®æ”¹
    // â›”ï¸ [ç¦åŒº] â†‘ ä¸Šé¢è¿™ä¸ªåå¼•å· ` å’Œåˆ†å· ; ä¸è¦åˆ é™¤ï¼
}
// â›”ï¸ [ç¦åŒº] â†‘ è¿™ä¸ªå³èŠ±æ‹¬å· } ä¸è¦åˆ é™¤ï¼

/**
 * ã€è§’è‰²ä¸€è‡´æ€§æè¿°æ¨¡æ¿ã€‘
 *
 * ç”¨é€”ï¼šä¸ºæ¯ä¸ªè§’è‰²ç”Ÿæˆä¸€è‡´æ€§å¼ºè°ƒçš„æè¿°æ–‡æœ¬
 * â›”ï¸ [ç¦åŒº] æ•´ä¸ªå‡½æ•°ä¸è¦ä¿®æ”¹ï¼è¿™æ˜¯ç¨‹åºé€»è¾‘ä»£ç 
 */
export function buildCharacterPrompt(characters: Character[]): string {
    if (characters.length === 0) return "";

    const validCharacters = characters.filter(c => c.name && c.description);
    if (validCharacters.length === 0) return "";

    const charDescriptions = validCharacters
        .map(c => {
            // âœ… [å¯ç¼–è¾‘åŒºåŸŸ] ä¸‹é¢çš„è‹±æ–‡ä¸€è‡´æ€§æç¤ºä½ å¯ä»¥ä¿®æ”¹
            return `ã€${c.name}ã€‘: ${c.description} (This character must appear exactly the same in every scene - same colors, same proportions, same clothing, same features)`;
        })
        .join("\n");

    return `\n\n=== CHARACTER REFERENCE (MUST BE CONSISTENT) ===\n${charDescriptions}\n=== END CHARACTER REFERENCE ===\n\n`;
}
